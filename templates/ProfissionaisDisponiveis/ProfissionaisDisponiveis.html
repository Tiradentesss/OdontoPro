{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profissionais Disponíveis</title>

    <link rel="stylesheet" href="{% static 'css/ProfissionaisDisponiveis/ProfissionaisDisponiveis.css' %}">
    <link rel="stylesheet" href="{% static 'css/HeaderFooter/HeaderFooter.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

{% include 'partials/header/header.html' %}

<main class="container">

    <!-- FILTROS -->
    <aside class="filtros">
        <div class="filtro-box">
            <h3>Filtrar por Especialidade</h3>

            <select id="select-especialidade">
                <option value="">Todas</option>
                {% for esp in especialidades %}
                    <option value="{{ esp.nome }}">{{ esp.nome }}</option>
                {% endfor %}
            </select>

            <button class="btn-aplicar" onclick="aplicarFiltro()">Aplicar</button>
        </div>
    </aside>

    <!-- PROFISSIONAIS -->
    <section class="conteudo">
        <h2>Profissionais da Clínica {{ clinica.nome }}</h2>

        <div class="cards" id="cards-container">

            {% for profissional in profissionais %}
            <section class="card"
                data-especialidade="{% for esp in profissional.especialidades.all %}{{ esp.nome }} {% endfor %}"
                onclick="location.href='{% url 'perfilDoProfissional' profissional.id %}'">

                <!-- FOTO -->
                {% if profissional.foto %}
                    <img src="{{ profissional.foto.url }}" alt="{{ profissional.nome }}">
                {% else %}
                    <img src="{% static 'imgs/default-user.png' %}" alt="Sem foto">
                {% endif %}

                <!-- NOME -->
                <h4>{{ profissional.nome }}</h4>

                <!-- ESPECIALIDADES -->
                <p>
                    {% for esp in profissional.especialidades.all %}
                        {{ esp.nome }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>

                <!-- AVALIAÇÃO FIXA (por enquanto) -->
                <div class="avaliacao">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                    <i class="far fa-star"></i>
                </div>

            </section>
            {% empty %}
            <p>Nenhum profissional encontrado.</p>
            {% endfor %}

        </div>
    </section>
</main>

{% include 'partials/footer/footer.html' %}

<script>
function aplicarFiltro() {
    let filtro = document.getElementById("select-especialidade").value.toLowerCase();
    let cards = document.querySelectorAll(".card");

    cards.forEach(card => {
        let esp = card.getAttribute("data-especialidade").toLowerCase();

        if (filtro === "" || esp.includes(filtro)) card.style.display = "block";
        else card.style.display = "none";
    });
}
</script>

</body>
</html>