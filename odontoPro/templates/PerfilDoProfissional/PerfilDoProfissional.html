{% load static %}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Perfil do Profissional - {{ profissional.nome }}</title>

  <link rel="stylesheet" href="{% static 'css/HeaderFooter/HeaderFooter.css' %}">
  <link rel="stylesheet" href="{% static 'css/PerfilDoProfissional/PerfilDoProfissional.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous"/>
</head>
<body>

  {% block header %}
  {% include 'partials/header/header.html' %}
  {% endblock %}

<main class="perfil-container">
  <section class="perfil-main">

    <div class="perfil-header">
      {% if profissional.foto %}
        <img src="{{ profissional.foto.url }}" alt="{{ profissional.nome }}" class="perfil-foto"/>
      {% else %}
        <img src="{% static 'img/UserIcon.png' %}" alt="{{ profissional.nome }}" class="perfil-foto"/>
      {% endif %}

      <div class="perfil-info">
        <h2>{{ profissional.nome }}</h2>

        <p class="especialidade">
          {% for esp in profissional.especialidades.all %}
            {{ esp.nome }}{% if not forloop.last %}, {% endif %}
          {% empty %}
            Profissional
          {% endfor %}
        </p>

        <div class="avaliacao">
          {% for i in "12345" %}
            {% if forloop.counter <= profissional.avaliacao|floatformat:0 %}
              <i class="fas fa-star"></i>
            {% else %}
              <i class="far fa-star"></i>
            {% endif %}
          {% endfor %}
          <span>{{ profissional.avaliacao|default:"5.0" }} ({{ profissional.num_avaliacoes }} avaliações)</span>
        </div>

        <div>
          <strong>Clínica:</strong> {{ clinica.nome }}
        </div>
      </div>

      <button id="btn-open-agenda" class="btn-agendar">Agendar Consulta</button>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab-button active" data-tab="sobre">Sobre</button>
      <button class="tab-button" data-tab="experiencia">Experiência</button>
      <button class="tab-button" data-tab="avaliacao">Avaliações</button>
    </div>

    <div class="tab-content" id="sobre" style="display:block;">
      <p>{{ profissional.nome }} atua em {{ clinica.nome }}.</p>
      {% if profissional.crm_cro %}
        <p>CRM/CRO: {{ profissional.crm_cro }}</p>
      {% endif %}
      <p>{{ profissional.email }}</p>
    </div>

    <div class="tab-content" id="experiencia" style="display:none;">
      <ul>
        {% for esp in profissional.especialidades.all %}
          <li>{{ esp.nome }}</li>
        {% empty %}
          <li>Não informado</li>
        {% endfor %}
      </ul>
    </div>

    <div class="tab-content" id="avaliacao" style="display:none;">
      <div class="comentario-container">
        <div class="comentario-input">
          <input type="text" placeholder="Adicione um comentário">
          <button>Adicionar</button>
        </div>
      </div>
    </div>

  </section>
</main>

<!-- MODAL AGENDA -->
<div id="agenda-modal" class="modal-overlay" aria-hidden="true">
  <div class="modal-content">
    <span class="close-modal" id="fechar-modal">&times;</span>
    <h3>Agende com {{ profissional.nome }}</h3>

    <label>Escolha a data</label>
    <input type="date" id="data" min="{{ today|date:'Y-m-d' }}">

    <label>Horários disponíveis</label>
    <div id="horarios-list" class="horarios">
      <p class="muted">Escolha uma data.</p>
    </div>

    <div style="display:flex; gap:.5rem;">
      <button id="btn-selecionar" class="btn-agendar-final" disabled>Continuar</button>
      <button id="btn-cancelar" class="btn-agendar-final" style="background:#ccc;">Fechar</button>
    </div>
  </div>
</div>

<!-- MODAL DADOS -->
<div id="dados-consulta-modal" class="modal-overlay" aria-hidden="true">
  <div class="modal-content">
    <span class="close-modal" id="fechar-dados">&times;</span>
    <h3>Confirme seus dados</h3>

    <form id="formDadosConsulta">
      {% csrf_token %}

      <input type="hidden" id="selected_date">
      <input type="hidden" id="selected_time">

      <label>Nome Completo</label>
      <input
        type="text"
        id="nome"
        value="{{ paciente.nome|default:'' }}"
        required
      >

      <label>Email</label>
      <input
        type="email"
        id="email"
        value="{{ paciente.email|default:'' }}"
        required
      >

      <label>Telefone</label>
      <input
        type="tel"
        id="telefone"
        value="{{ paciente.telefone|default:'' }}"
        required
      >

      <label>Especialidade</label>
      <select id="especialidade">
        <option value="">Selecione (opcional)</option>
        {% for esp in especialidades %}
          <option value="{{ esp.nome }}">{{ esp.nome }}</option>
        {% endfor %}
      </select>

      <label>Observações</label>
      <textarea id="observacoes"></textarea>

      <button type="submit" class="btn-agendar-final">
        Confirmar Agendamento
      </button>
    </form>
  </div>
</div>

<!-- MODAL SUCESSO -->
<div id="sucesso-modal" class="modal-overlay" aria-hidden="true">
  <div class="modal-content sucesso">
    <i class="fas fa-check-circle"></i>
    <h3>Consulta Agendada</h3>
    <p id="sucesso-text"></p>
    <button id="voltarInicio" class="btn-agendar-final">Fechar</button>
  </div>
</div>

{% block footer %}
{% include 'partials/footer/footer.html' %}
{% endblock %}

<script>
  window.PROFISSIONAL_ID = {{ profissional.id }};
  window.CSRF_TOKEN = "{{ csrf_token }}";
</script>

<script defer src="{% static 'js/PerfilDoProfissional/PerfilDoProfissional.js' %}"></script>

</body>
</html>
